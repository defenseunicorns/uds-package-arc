kind: ZarfPackageConfig
metadata:
  name: actions-runner-controller-full
  description: "Deploys actions/actions-runner-controller self hosted GitHub Actions"

variables:
  - name: GITHUB_CONFIG_URL
    prompt: true
  - name: GITHUB_APP_ID
    prompt: true
  - name: GITHUB_APP_INSTALLATION_ID
    prompt: true
  - name: GITHUB_APP_PRIVATE_KEY
    prompt: true
  - name: GITHUB_RUNNER_GROUP
    prompt: true
    default: "default"
  - name: GITHUB_RUNNER_SCALESET_NAME
    prompt: true

components:
- name: zarf-ignore-arc-runners-ns
  required: true
  manifests:
    - name: runner-scale-set-manifests
      namespace: arc-runners
      files:
      - runner-scale-set/namespace.yaml

- name: actions-runner-controller
  required: true
  charts:      
    - name: runner-scale-set-controller
      releaseName: runner-scale-set-controller
      url: oci://ghcr.io/actions/actions-runner-controller-charts/gha-runner-scale-set-controller
      version: 0.4.0
      namespace: arc-systems
      valuesFiles:
        - "runner-scale-set-controller/values.yaml"

    - name: runner-scale-set
      releaseName: runner-scale-set
      url: oci://ghcr.io/actions/actions-runner-controller-charts/gha-runner-scale-set
      version: 0.4.0
      namespace: arc-runners
      valuesFiles:
        - "runner-scale-set/values.yaml"


  images:
    - ghcr.io/actions/gha-runner-scale-set-controller:0.4.0
    - ghcr.io/actions/actions-runner:latest
    - docker:dind

    # Required if `zarf.dev/agent: ignore` namespace label is not used:
    # - summerwind/actions-runner:latest
    # - docker:dind
    # - summerwind/actions-runner-dind-rootless:latest
    # - summerwind/actions-runner-dind:latest
